module.exports = function(req, res){
    var unixTime = Math.round((new Date()).getTime() / 1000);
    if(Math.abs(req.query.time - unixTime) > 60){//One minute tolerance
        res.json({error:'Timeout'});
        return;
    }
    var crypto = require('crypto');
    var token = 'id=' + req.query.id + '&time=' + req.query.time + '&secret=' + global.config.secret;
    var myKey = crypto.createHash('md5').update(token).digest('hex');
    if(myKey != req.query.key){
        res.json({error:'Key Error'});
        return;
    }
    req.session.host = {
        hostid: req.query.id,
        nick: req.query.nick
    };
    var rand = Math.floor(19201080*Math.random());
    var newToken = 'id=' + req.query.id + '&time=' + unixTime + '&rand=' + rand + '&secret=' + global.config.secret;
    var newKey = crypto.createHash('md5').update(newToken).digest('hex');
    res.json({
        success:1,
        id:req.query.id,
        time:unixTime,
        rand:rand,
        key:newKey
    });
}
/*
var db = {
    danielsig727:   1,
    a10485a:        2,
    solan:          3,
    teemo:          4,
    ice6968:        5,
    habosky:        6,
    ju2willy:       7,
    ensky:          8,
    martinetlee:    9,
    vzf:            10,
    windfromdark:   11,
    tonytonyjan:    12,
    sniealu:        13

}
module.exports = function(req, res){
    if(!req.query.nick || !db[req.query.nick] || req.query.password!="1234"){
        res.json({error:'Login Error:'+req.query.nick+':'+req.query.password});
        return;
    }
    req.session.host = {
//        hostid: req.query.hostid,
        hostid: db[req.query.nick],
        nick: req.query.nick,
    };
//    console.log('Host id ' + req.query.hostid + ' login');
    res.json({msg:'Login Success!'});
    return;
    console.log(req.query.nick + ' ID ' + req.session.host.hostid + 'login');
    res.redirect('/host.html?hostid='+req.session.host.hostid+'&nick='+req.query.nick);
}
*/
